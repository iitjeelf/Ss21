<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Exam</title>
<style>
/* === DESIGN KEPT EXACTLY AS REQUESTED === */
body{font-family:"SF Pro Display",Arial,sans-serif;margin:0;background:#fff;color:#000;}
header{background:linear-gradient(145deg,#E6E6FA,#D8BFD8);color:#4B0082;text-align:center;padding:20px;font-size:36px;font-weight:700;letter-spacing:1.5px;box-shadow:0 5px #aaa;text-shadow:0 1px 2px #fff;}
#studentEntry,#examArea{padding:20px;text-align:center;}
.form-group{display:flex;flex-direction:row;align-items:center;justify-content:center;margin-bottom:15px;}
.form-group label{font-size:1.15rem;font-weight:600;margin-right:10px;color:#4B0082;width:120px;text-align:right;}
input[type="text"]{padding:10px 12px;font-size:1.1rem;border-radius:10px;border:1.5px solid #4B0082;outline:none;min-width:250px;}
input.error{animation:glowRed 0.5s alternate infinite;border-color:red;}
@keyframes glowRed{0%{box-shadow:0 0 5px red;}100%{box-shadow:0 0 15px red;}}
button{position:relative;overflow:hidden;cursor:pointer;border:none;border-radius:12px;transition:all .18s ease;box-shadow:0 6px #aaa;background:linear-gradient(to bottom,#fafaff,#dcd6f7);color:#4B0082;font-weight:600;padding:10px 20px;font-size:18px;}
button:hover{transform:translateY(-2px);box-shadow:0 8px 15px rgba(0,0,0,.28);}
button:active{transform:translateY(3px) scale(.98);}
.optBtn{font-size:16px;padding:8px 18px;margin:6px;border:2px solid #4B0082;background:#fff;border-radius:8px;box-shadow:0 5px #aaa;}
.optBtn.selected{background:#32CD32;color:#fff;border-color:#2fa92f;}
.navContainer{display:flex;justify-content:center;gap:10px;margin:10px 0;flex-wrap:wrap}
.navBtn{font-size:16px;padding:10px 20px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;background:linear-gradient(145deg,#1E90FF,#4682B4);}
#markReviewBtn{background:linear-gradient(145deg,#ffb84d,#ff9900)}
#submitBtn{background:linear-gradient(145deg,#c8b88a,#b49e60)}
#timerEl{font-size:20px;font-weight:bold;color:#4B0082;padding:6px 12px;border-radius:6px;background:#f0f0ff;display:inline-block;transition: all 0.3s ease;}
#timerEl.blink{animation:blinkTimer 1s infinite;}
@keyframes blinkTimer{0%{background:#ff6666;color:#fff;}50%{background:#fff;color:#4B0082;}100%{background:#ff6666;color:#fff;}}
#paletteContainer button{width:36px;height:36px;border-radius:50%;font-size:14px;margin:3px;border:1px solid #4B0082;background:#E6E6FA;color:#4B0082;}
#paletteContainer button.selected{background:#32CD32;color:#fff;border-color:#2fa92f}
#paletteContainer button.reviewed{background:yellow;color:#000}
#paletteContainer button.current{border:3px solid red}
footer{background:#E6E6FA;color:#4B0082;padding:10px;text-align:center;font-weight:bold;position:fixed;width:100%;bottom:0;}
.sectionTitle{font-size:22px;color:#4B0082;font-weight:bold;margin-bottom:8px;}
img.questionImg{max-width:100%;border-radius:10px;}
.glow {animation: glowPulse 1.6s infinite alternate;box-shadow:0 8px 18px rgba(75,0,130,0.12);}
@keyframes glowPulse{0% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); } 50% { box-shadow:0 12px 30px rgba(75,0,130,0.14); transform:translateY(-2px); } 100% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); }}
#fullRedOverlay{ position:fixed; left:0; top:0; width:100%; height:100%; display:none; z-index:9999; pointer-events:auto; }
#fullRedOverlay .overlay-slice{ position:absolute; top:0; bottom:0; width:calc(100%/7); height:100%; background:red; left:0; transition:opacity .45s ease, transform .45s ease; }
#accessDeniedBox{ position:fixed; left:50%; top:40%; transform:translate(-50%,-50%); z-index:10000; color:#fff; text-align:center; display:none; pointer-events:auto; }
#accessDeniedBox h1{ font-size:48px; font-weight:900; margin:0 0 18px 0; color:#fff; text-shadow:0 2px 6px rgba(0,0,0,0.4); }
#callAdminBtn{ padding:12px 22px; border-radius:12px; font-weight:800; }
.confirmModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:10001;}
.confirmBox{background:#fff;padding:20px;border-radius:12px;min-width:280px;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,0.3);}
.confirmBox p{font-size:18px;color:#4B0082;margin-bottom:15px;}
.confirmBox button{margin:0 10px;padding:8px 16px;font-size:16px;cursor:pointer;}
@media(max-width:600px){ #accessDeniedBox h1{font-size:28px;} #callAdminBtn{padding:10px 14px;} .form-group{flex-direction:column;align-items:flex-start;} .form-group label{text-align:left;width:auto;margin-bottom:5px;} }
</style>
</head>
<body>
<header>LFJC ONLINE EXAMINATION</header>

<div id="studentEntry">
  <div class="form-group"><label>Name</label><input type="text" id="stuName" placeholder="Only letters & spaces" autocomplete="off" autocapitalize="words"></div>
  <div class="form-group"><label>Section</label><input type="text" id="stuSection" placeholder="Letters & digits" autocomplete="off"></div>
  <div class="form-group"><label>Roll</label><input type="text" id="stuRoll" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><label>Admission No</label><input type="text" id="stuAdm" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><button id="stuStartBtn" style="display:none;">Start Exam</button></div>
  <p id="studentMsg"></p>
</div>

<div id="examArea" style="display:none;">
  <div id="examHeader" style="display:flex;justify-content:space-between;align-items:center;">
    <div id="stuInfo" style="text-align:left;font-weight:bold;"></div>
    <div id="timerEl">ðŸ•’ 00:00</div>
  </div>
  <div id="questionContainer" style="text-align:center;margin-top:10px;"></div>
  <div id="qNumber" style="font-weight:bold;color:#4B0082;margin-top:10px;"></div>
  <div class="navContainer">
    <button class="navBtn" id="prevBtn">â¬… Previous</button>
    <button class="navBtn" id="markReviewBtn">Review / Unreview</button>
    <button class="navBtn" id="nextBtn">Next âž¡</button>
    <button class="navBtn" id="submitBtn">Submit Exam</button>
  </div>
  <div id="paletteContainer"></div>
</div>

<footer>LFJC@2025 All rights reserved</footer>

<div id="fullRedOverlay" aria-hidden="true"></div>
<div id="accessDeniedBox" aria-hidden="true">
  <h1 id="accessDeniedText">ACCESS DENIED</h1>
  <div><button id="callAdminBtn" class="glow">CALL ADMIN</button></div>
</div>

<div class="confirmModal" id="confirmModal">
  <div class="confirmBox">
    <p id="confirmText">Confirm?</p>
    <button id="confirmYes">Yes</button>
    <button id="confirmNo">No</button>
  </div>
</div>

<script>
/* === Exam logic (shortened for clarity, keeping original design untouched) === */
const MARK_PER_CORRECT=1,MARK_PER_WRONG=-0.25;
let images=["1.png","2.png","3.png","4.png","5.png","6.png"];
let answerKey=["A","B","C","D","A","B"];
const subjects=["Maths","Physics","Chemistry"];
let examData={files:[],subjectNames:[],keys:[]};
let progress=null,timerInterval=null,pendingAttempt=null;
const LS_KEY='lfjc_attempts_v1';
function shuffleArray(a){const c=a.slice();for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];}return c;}
function makeStudentIdRaw(n,s,r,a){return `${n.trim().toLowerCase()}|${s.trim().toLowerCase()}|${r.trim()}|${a.trim()}`;}
function storeAttemptLocal(stu){const raw=makeStudentIdRaw(stu.name,stu.sec,stu.roll,stu.adm);const arr=JSON.parse(localStorage.getItem(LS_KEY)||'[]');arr.push({raw,t:Date.now()});localStorage.setItem(LS_KEY,JSON.stringify(arr));}
function isBlockedByPrevious(n,s,r,a){try{const arr=JSON.parse(localStorage.getItem(LS_KEY)||'[]');const cut=Date.now()-86400000;for(let x of arr){if(x.t<cut)continue;const p=(x.raw||'').split('|');if(p.length<4)continue;let m=0;if(n.toLowerCase().trim()===p[0])m++;if(s.toLowerCase().trim()===p[1])m++;if(r.trim()===p[2])m++;if(a.trim()===p[3])m++;if(m>=2)return true;}}catch(e){}return false;}
function prepareExamData(){examData.files=[];examData.subjectNames=[];examData.keys=[];const total=images.length;const base=Math.floor(total/3);let rem=total%3;let st=0;const groups=[];for(let s=0;s<3;s++){const c=base+(rem>0?1:0);rem--;const gi=images.slice(st,st+c);const gk=answerKey.slice(st,st+c);st+=c;const idx=shuffleArray([...Array(gi.length).keys()]);groups.push({name:subjects[s],imgs:idx.map(i=>gi[i]),keys:idx.map(i=>gk[i])});}shuffleArray(groups).forEach(g=>g.imgs.forEach((im,i)=>{examData.files.push(im);examData.keys.push(g.keys[i]);examData.subjectNames.push(g.name);}));}

function validateStudentInputs(){
 const n=document.getElementById('stuName'),s=document.getElementById('stuSection'),r=document.getElementById('stuRoll'),a=document.getElementById('stuAdm');
 let vn=/^[A-Za-z .]+$/.test(n.value),vs=/^[A-Za-z0-9]+$/.test(s.value),vr=/^[0-9]+$/.test(r.value),va=/^[0-9]+$/.test(a.value);
 n.classList.toggle('error',!vn&&n.value!=="");s.classList.toggle('error',!vs&&s.value!=="");r.classList.toggle('error',!vr&&r.value!=="");a.classList.toggle('error',!va&&a.value!=="");
 const all=vn&&vs&&vr&&va;const btn=document.getElementById('stuStartBtn');btn.style.display=all?'inline-block':'none';if(all)btn.classList.add('glow');else btn.classList.remove('glow');return all;
}
['stuName','stuSection','stuRoll','stuAdm'].forEach(id=>document.getElementById(id).addEventListener('input',validateStudentInputs));

function showConfirm(t,cb){const m=document.getElementById('confirmModal');document.getElementById('confirmText').textContent=t;m.style.display='flex';document.getElementById('confirmYes').onclick=()=>{m.style.display='none';cb(true)};document.getElementById('confirmNo').onclick=()=>{m.style.display='none';cb(false)};}

document.getElementById('stuStartBtn').onclick=()=>{
 if(!validateStudentInputs())return;
 const n=stuName.value.trim(),s=stuSection.value.trim(),r=stuRoll.value.trim(),a=stuAdm.value.trim();
 pendingAttempt={name:n,sec:s,roll:r,adm:a};
 if(isBlockedByPrevious(n,s,r,a)){showRedOverlay();return;}
 showConfirm("Are you sure you want to START the exam? Once started, timer will begin.",ok=>{
  if(!ok)return;
  prepareExamData();
  progress={answers:Array(examData.files.length).fill(null),review:Array(examData.files.length).fill(false),currentIndex:0,student:{name:n,sec:s,roll:r,adm:a},timeLeftSec:5*60};
  studentEntry.style.display='none';examArea.style.display='block';renderQuestion();renderPalette();startTimer();updateNavButtons();
 });
};

function startTimer(){
 const t=document.getElementById('timerEl'),si=document.getElementById('stuInfo');
 timerInterval=setInterval(()=>{if(progress.timeLeftSec<=0){clearInterval(timerInterval);submitExam();return;}
 progress.timeLeftSec--;let m=Math.floor(progress.timeLeftSec/60),s=progress.timeLeftSec%60;
 t.textContent=`ðŸ•’ ${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
 si.textContent=`${progress.student.name} | ${progress.student.sec} | ${progress.student.roll} | ${progress.student.adm}`;
 if(progress.timeLeftSec<=300)t.classList.add('blink');else t.classList.remove('blink');
},1000);
}

function renderQuestion(){
 const q=document.getElementById('questionContainer');const f=examData.files[progress.currentIndex];const subj=examData.subjectNames[progress.currentIndex];
 q.innerHTML=`<div class="sectionTitle">${subj}</div><img src="${f}" class="questionImg"><br>`;
 ["A","B","C","D"].forEach(opt=>{const b=document.createElement('button');b.className='optBtn';b.textContent=opt;
 if(progress.answers[progress.currentIndex]===opt)b.classList.add('selected');
 b.onclick=()=>{if(progress.answers[progress.currentIndex]===opt)progress.answers[progress.currentIndex]=null;else progress.answers[progress.currentIndex]=opt;renderPalette();renderQuestion();};
 q.appendChild(b);});
 document.getElementById('qNumber').textContent=`Q ${progress.currentIndex+1}/${examData.files.length}`;
}
prevBtn.onclick=()=>{if(progress.currentIndex>0){progress.currentIndex--;renderQuestion();renderPalette();updateNavButtons();}};
nextBtn.onclick=()=>{if(progress.currentIndex<examData.files.length-1){progress.currentIndex++;renderQuestion();renderPalette();updateNavButtons();}};
markReviewBtn.onclick=()=>{progress.review[progress.currentIndex]=!progress.review[progress.currentIndex];renderPalette();};
submitBtn.onclick=()=>{showConfirm("Are you sure you want to SUBMIT the exam?",ok=>{if(ok)submitExam();});};

function renderPalette(){
 const c=document.getElementById('paletteContainer');c.innerHTML='';
 progress.answers.forEach((ans,i)=>{const b=document.createElement('button');b.textContent=i+1;
 if(progress.review[i])b.classList.add('reviewed');else if(ans)b.classList.add('selected');
 if(i===progress.currentIndex)b.classList.add('current');
 b.onclick=()=>{progress.currentIndex=i;renderQuestion();renderPalette();updateNavButtons();};c.appendChild(b);});
}

function updateNavButtons(){prevBtn.style.display=progress.currentIndex===0?'none':'inline-block';nextBtn.style.display=progress.currentIndex===examData.files.length-1?'none':'inline-block';}

function submitExam(){
 clearInterval(timerInterval);
 const data={};examData.subjectNames.forEach((s,i)=>{if(!data[s])data[s]={c:0,w:0,b:0,t:0};const ans=progress.answers[i];if(ans===null)data[s]()
// continuing from where it cut off...

function submitExam(){
  clearInterval(timerInterval);
  const data={};
  examData.subjectNames.forEach((s,i)=>{
    if(!data[s]) data[s]={c:0,w:0,b:0,t:0};
    const ans = progress.answers[i];
    if(ans === null) data[s].b++;
    else if(ans === examData.keys[i]) data[s].c++;
    else data[s].w++;
    data[s].t++;
  });

  // store attempt locally (so blocking logic works for 24 hours)
  try{ storeAttemptLocal(progress.student); }catch(e){ /* ignore storage errors */ }

  // build result HTML â€” student info at top, table increased by 30% (relative to normal)
  let html = `<h2 style="color:#4B0082;">RESULT</h2>
  <div style="text-align:center;font-weight:bold;margin-bottom:10px;">
    Student: ${progress.student.name} | Section: ${progress.student.sec} | Roll: ${progress.student.roll} | Adm: ${progress.student.adm}
  </div>
  <table border="1" style="border-collapse:collapse;width:140%;margin:0 auto;text-align:center;">
    <tr style="background:#E6E6FA;">
      <th>Subject</th><th>Correct</th><th>Wrong</th><th>Blank</th><th>Total</th><th>%</th>
    </tr>`;

  let totalC=0,totalW=0,totalB=0,totalT=0;
  for(const sub in data){
    const s = data[sub];
    const perc = s.t ? ((s.c/s.t)*100).toFixed(2) : "0.00";
    totalC += s.c; totalW += s.w; totalB += s.b; totalT += s.t;
    html += `<tr style="background:#fff;">
      <td>${sub}</td>
      <td style="text-align:center;">${s.c}</td>
      <td style="text-align:center;">${s.w}</td>
      <td style="text-align:center;">${s.b}</td>
      <td style="text-align:center;">${s.t}</td>
      <td style="text-align:center;">${perc}%</td>
    </tr>`;
  }

  const totalPerc = totalT ? ((totalC/totalT)*100).toFixed(2) : "0.00";
  html += `<tr style="background:#D8BFD8;font-weight:bold;">
    <td>Total</td>
    <td style="text-align:center;">${totalC}</td>
    <td style="text-align:center;">${totalW}</td>
    <td style="text-align:center;">${totalB}</td>
    <td style="text-align:center;">${totalT}</td>
    <td style="text-align:center;">${totalPerc}%</td>
  </tr></table>`;

  html += `<p style="text-align:center;margin-top:15px;color:#4B0082;font-weight:bold;">Thank you for attempting the exam!</p>`;
  html += `<div style="text-align:center;margin-top:10px;"><button id="finalLogoutBtn">Logout</button></div>`;

  // replace body with results (keeps fonts/colors/layout because we reuse your inline styles)
  document.body.innerHTML = html;

  // attach logout handler that attempts to close, with a fallback to about:blank
  document.getElementById('finalLogoutBtn').onclick = function(){
    try{ window.close(); }catch(e){}
    // some browsers disallow close; fallback
    window.location.href = 'about:blank';
  };
}

// LOGOUT function used in other places (keeps behavior consistent)
function logout(){
  try{ window.close(); }catch(e){}
  window.location.href = 'about:blank';
}

// RED overlay / ACCESS DENIED handling (password: lfjc2025)
function showRedOverlay(){
  const overlay = document.getElementById('fullRedOverlay');
  overlay.innerHTML = ''; // clear any previous slices
  overlay.style.display = 'block';
  for(let i=0;i<7;i++){
    const s = document.createElement('div');
    s.className = 'overlay-slice';
    s.style.left = (i*100/7) + '%';
    overlay.appendChild(s);
  }
  const accessBox = document.getElementById('accessDeniedBox');
  accessBox.style.display = 'block';
  // keep CALL ADMIN behavior but prompt for password
  document.getElementById('callAdminBtn').onclick = function(){
    const pass = prompt('Enter password to bypass:');
    if(pass === 'lfjc2025'){
      // remove overlay and access box (student can then use the form)
      overlay.style.display = 'none';
      accessBox.style.display = 'none';
      // if a pendingAttempt exists (student typed details and got blocked), allow start button to appear
      if(pendingAttempt){
        // restore inputs from pendingAttempt and allow starting
        try{
          document.getElementById('stuName').value = pendingAttempt.name || '';
          document.getElementById('stuSection').value = pendingAttempt.sec || '';
          document.getElementById('stuRoll').value = pendingAttempt.roll || '';
          document.getElementById('stuAdm').value = pendingAttempt.adm || '';
          validateStudentInputs();
        }catch(e){}
        pendingAttempt = null;
      }
    } else {
      alert('Wrong password!');
    }
  };
}

// ensure any global elements referenced exist (defensive)
window.addEventListener('DOMContentLoaded', ()=>{ /* no-op; keeps original behavior */ });
</script>
</body>
</html>
